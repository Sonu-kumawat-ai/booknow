<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - BookNow</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/settings.css') }}">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <a href="{{ url_for('main.index') }}">
                    <h1>Book<span>Now</span></h1>
                </a>
            </div>
            <ul class="nav-links">
                <li><a href="{{ url_for('main.index') }}">Home</a></li>
                <li><a href="{{ url_for('main.all_movies') }}">Movies</a></li>
                <li><a href="{{ url_for('user.settings') }}" class="active">Settings</a></li>
            </ul>
            <div class="nav-auth">
                <div class="profile-dropdown">
                    <button class="profile-icon active" id="profileToggle">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <circle cx="12" cy="8" r="3"></circle>
                            <path d="M6.168 18.849A4 4 0 0 1 10 16h4a4 4 0 0 1 3.834 2.855"></path>
                        </svg>
                    </button>
                    <div class="dropdown-menu" id="profileMenu">
                        <a href="{{ url_for('user.profile') }}" class="dropdown-item">
                            <span class="dropdown-icon">üë§</span>
                            My Profile
                        </a>
                        <a href="{{ url_for('user.settings') }}" class="dropdown-item">
                            <span class="dropdown-icon">‚öôÔ∏è</span>
                            Settings
                        </a>
                        {% if user_data and (user_data.role == 'theatre_owner' or user_data.role == 'admin') %}
                            <div class="dropdown-divider"></div>
                            <a href="{{ url_for('theatre.theatre_dashboard') }}" class="dropdown-item">
                                <span class="dropdown-icon">üìä</span>
                                Theatre Dashboard
                            </a>
                            <a href="{{ url_for('movie.add_movie') }}" class="dropdown-item">
                                <span class="dropdown-icon">üé¨</span>
                                Add Movie
                            </a>
                        {% endif %}
                        {% if user_data and user_data.role == 'admin' %}
                            <div class="dropdown-divider"></div>
                            <a href="{{ url_for('admin.admin') }}" class="dropdown-item">
                                <span class="dropdown-icon">üõ°Ô∏è</span>
                                Admin Panel
                            </a>
                        {% endif %}
                        <div class="dropdown-divider"></div>
                        <a href="{{ url_for('auth.logout') }}" class="dropdown-item">
                            <span class="dropdown-icon">üö™</span>
                            Logout
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-container">
                {% for category, message in messages %}
                    <div class="flash-message flash-{{ category }}">
                        {{ message }}
                        <button class="close-flash">&times;</button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Settings Section -->
    <section class="profile-section">
        <div class="container">
            <div class="settings-header">
                <h1>‚öôÔ∏è Settings</h1>
                <p>Manage your account preferences and security settings</p>
            </div>

            <div class="settings-container">
                <!-- Account Settings -->
                <div class="profile-card">
                    <div class="card-header">
                        <h3>Account Settings</h3>
                    </div>
                    <div class="card-body">
                        <form class="settings-form" method="POST" action="{{ url_for('user.update_email') }}" id="emailForm">
                            <div class="form-group">
                                <label for="username">Username</label>
                                <input type="text" id="username" name="username" value="{{ user.username }}" readonly>
                                <small>Username cannot be changed</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="email">Email Address</label>
                                <div class="input-with-button">
                                    <input type="email" id="email" name="email" value="{{ user.email }}" required>
                                    <button type="submit" class="btn btn-primary btn-sm">Update Email</button>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="phone">Phone Number</label>
                                <input type="tel" id="phone" name="phone" placeholder="Enter phone number">
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Password & Security -->
                <div class="profile-card">
                    <div class="card-header">
                        <h3>Password & Security</h3>
                    </div>
                    <div class="card-body">
                        <form class="settings-form" method="POST" action="{{ url_for('user.change_password') }}">
                            <div class="form-group">
                                <label for="current_password">Current Password</label>
                                <input type="password" id="current_password" name="current_password" placeholder="Enter current password" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="new_password">New Password</label>
                                <input type="password" id="new_password" name="new_password" placeholder="Enter new password" required minlength="6">
                            </div>

                            <div class="form-group">
                                <label for="confirm_password">Confirm New Password</label>
                                <input type="password" id="confirm_password" name="confirm_password" placeholder="Confirm new password" required minlength="6">
                            </div>

                            <button type="submit" class="btn btn-primary">Change Password</button>
                        </form>
                    </div>
                </div>

                <!-- Notification Preferences -->
                <div class="profile-card">
                    <div class="card-header">
                        <h3>Notification Preferences</h3>
                    </div>
                    <div class="card-body">
                        <div class="settings-toggle-list">
                            <div class="toggle-item">
                                <div class="toggle-info">
                                    <h4>Email Notifications</h4>
                                    <p>Receive booking confirmations and updates via email</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="toggle-item">
                                <div class="toggle-info">
                                    <h4>Promotional Emails</h4>
                                    <p>Get notified about special offers and new releases</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="toggle-item">
                                <div class="toggle-info">
                                    <h4>SMS Notifications</h4>
                                    <p>Receive booking reminders via SMS</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Google Calendar Connect (moved below) -->

                <!-- Privacy Settings -->
                <div class="profile-card">
                    <div class="card-header">
                        <h3>Privacy & Data</h3>
                    </div>
                    <div class="card-body">
                        <div class="settings-toggle-list">
                            <div class="toggle-item">
                                <div class="toggle-info">
                                    <h4>Share Viewing History</h4>
                                    <p>Allow BookNow to use your viewing history for recommendations</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="toggle-item">
                                <div class="toggle-info">
                                    <h4>Public Profile</h4>
                                    <p>Make your profile visible to other users</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Theatre Owner Section -->
                {% if user.role != 'admin' %}
                <!-- Google Calendar Prominent Card -->
                <div class="profile-card google-card">
                    <div class="card-header">
                        <h3>Google Calendar</h3>
                    </div>
                    <div class="card-body google-card-body">
                        {% if user.google_tokens %}
                            <div class="google-connected">
                                <div class="success-badge">‚úì Connected</div>
                                <p style="margin:0.5rem 0 1rem;">Google Calendar is connected to your account. Events will be added automatically when you book tickets.</p>
                                <div style="display:flex; gap:0.75rem; align-items:center;">
                                    <a href="#" id="disconnectCalendar" data-disconnect-url="{{ url_for('calendar.calendar_disconnect') }}" class="btn btn-outline">Disconnect Calendar</a>
                                    <a href="{{ user.google_tokens.get('htmlLink') if user.google_tokens else '#' }}" class="btn" style="background:transparent; color:var(--text-dark); text-decoration:underline;">View Calendar</a>
                                </div>
                            </div>
                        {% else %}
                                    {% if user.google_id %}
                                <div class="google-not-connected">
                                    <h4 style="margin:0 0 0.5rem;">Connect your Google Calendar</h4>
                                    <p style="margin:0 0 1rem;">Connect to allow BookNow to add showtimes to your Google Calendar automatically.</p>
                                    <a href="{{ url_for('calendar.calendar_connect') }}" class="btn btn-social btn-google">Connect Google Calendar</a>
                                </div>
                            {% else %}
                                <div class="google-require-signin">
                                    <h4 style="margin:0 0 0.5rem;">Sign in with Google to enable Calendar</h4>
                                    <p style="margin:0 0 1rem;">Please sign up or sign in with Google to use the Calendar integration.</p>
                                    <a href="{{ url_for('auth.google_login') }}" class="btn btn-social btn-google">Sign up / Sign in with Google</a>
                                </div>
                            {% endif %}
                        {% endif %}
                    </div>
                        </div>
                        <div class="profile-card">
                            <div class="card-header">
                        <h3>üé¨ Theatre Owner Portal</h3>
                    </div>
                    <div class="card-body">
                        {% if user.role == 'theatre_owner' %}
                            <div class="theatre-owner-active">
                                <div class="success-badge">
                                    <span>‚úì</span> You are a verified Theatre Owner
                                </div>
                                <p>You can now add and manage movies on BookNow</p>
                                <a href="{{ url_for('movie.add_movie') }}" class="btn btn-primary">Add New Movie</a>
                            </div>
                        {% elif pending_application %}
                            <div class="theatre-owner-pending">
                                <div class="pending-badge">
                                    <span>‚è≥</span> Request Pending
                                </div>
                                <p>Your theatre owner request is pending admin approval. Please wait for confirmation.</p>
                            </div>
                        {% elif rejected_application %}
                            <div class="theatre-owner-rejected">
                                <div class="rejected-badge">
                                    <span>‚úó</span> Request Rejected
                                </div>
                                <p>Your previous request was rejected. Please contact admin for more information.</p>
                            </div>
                        {% else %}
                            <div class="theatre-owner-info">
                                <h4>Become a Theatre Owner</h4>
                                <p>Register as a theatre owner to add and manage movie listings on BookNow</p>
                                <ul class="benefits-list">
                                    <li>‚úì Add unlimited movies to the platform</li>
                                    <li>‚úì Manage your movie listings</li>
                                    <li>‚úì Track bookings and revenue</li>
                                    <li>‚úì Access to analytics dashboard</li>
                                </ul>
                                
                                <a href="{{ url_for('theatre.theatre_owner_registration') }}" class="btn btn-primary" style="display: inline-block; margin-top: 2rem; text-decoration: none;">
                                    üìù Register Your Theatre
                                </a>
                                
                                <small style="display: block; margin-top: 1rem; color: var(--text-dark); opacity: 0.7;">
                                    * Requires admin approval
                                </small>
                            </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                <!-- Danger Zone -->
                <div class="profile-card">
                    <div class="card-header">
                        <h3>Danger Zone</h3>
                    </div>
                    <div class="card-body">
                        <div class="danger-zone">
                            <h4>Danger Zone</h4>
                            <p>Irreversible actions that affect your account</p>
                            <div class="danger-actions">
                                <a href="{{ url_for('auth.logout') }}" class="btn btn-outline" style="color: var(--primary-yellow); border-color: var(--primary-yellow);">Logout</a>
                                <button id="deleteAccountBtn" data-delete-url="{{ url_for('user.delete_account') }}" class="btn btn-danger">Delete Account</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Book<span>Now</span></h3>
                    <p>Your ultimate destination for hassle-free movie ticket booking. Experience cinema like never before.</p>
                    <div class="social-links">
                        <a href="#" class="social-icon">üìò</a>
                        <a href="#" class="social-icon">üê¶</a>
                        <a href="#" class="social-icon">üì∑</a>
                        <a href="#" class="social-icon">‚ñ∂Ô∏è</a>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="{{ url_for('main.index') }}">Home</a></li>
                        <li><a href="{{ url_for('main.index') }}#movies">Movies</a></li>
                        <li><a href="{{ url_for('main.index') }}#why-us">Why Us</a></li>
                        <li><a href="{{ url_for('user.profile') }}">Profile</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Terms of Service</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Contact Us</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contact Info</h4>
                    <ul>
                        <li>üìß support@booknow.com</li>
                        <li>üìû +1 (555) 123-4567</li>
                        <li>üìç 123 Movie Street, Cinema City</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 BookNow. All rights reserved.</p>
            </div>
        </div>
    </footer>
    <script src="{{ url_for('static', filename='js/common.js') }}"></script>
    <script src="{{ url_for('static', filename='js/settings.js') }}"></script>
</body>
</html>
