<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - BookNow</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <a href="{{ url_for('main.index') }}">
                    <h1>Book<span>Now</span></h1>
                </a>
            </div>
            <nav class="nav-links">
                <li><a href="{{ url_for('main.index') }}">Home</a></li>
                <li><a href="{{ url_for('main.all_movies') }}">Movies</a></li>
                <li><a href="{{ url_for('user.profile') }}" class="active">Profile</a></li>
            </ul>
            <div class="nav-auth">
                <div class="profile-dropdown">
                    <button class="profile-icon active" id="profileToggle">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <circle cx="12" cy="8" r="3"></circle>
                            <path d="M6.168 18.849A4 4 0 0 1 10 16h4a4 4 0 0 1 3.834 2.855"></path>
                        </svg>
                    </button>
                    <div class="dropdown-menu" id="profileMenu">
                        <a href="{{ url_for('user.profile') }}" class="dropdown-item">
                            <span class="dropdown-icon">üë§</span>
                            My Profile
                        </a>
                        <a href="{{ url_for('user.settings') }}" class="dropdown-item">
                            <span class="dropdown-icon">‚öôÔ∏è</span>
                            Settings
                        </a>
                            {% if user_data and (user_data.role == 'theatre_owner' or user_data.role == 'admin') %}
                                <div class="dropdown-divider"></div>
                                {% if user_data.role == 'theatre_owner' %}
                                    <a href="{{ url_for('theatre.theatre_dashboard') }}" class="dropdown-item">
                                        <span class="dropdown-icon">üìä</span>
                                        Theatre Dashboard
                                    </a>
                                {% endif %}
                                <a href="{{ url_for('movie.add_movie') }}" class="dropdown-item">
                                    <span class="dropdown-icon">üé¨</span>
                                    Add Movie
                                </a>
                            {% endif %}
                        {% if user_data and user_data.role == 'admin' %}
                            <div class="dropdown-divider"></div>
                            <a href="{{ url_for('admin.admin') }}" class="dropdown-item">
                                <span class="dropdown-icon">üõ°Ô∏è</span>
                                Admin Panel
                            </a>
                        {% endif %}
                        <div class="dropdown-divider"></div>
                        <a href="{{ url_for('auth.logout') }}" class="dropdown-item">
                            <span class="dropdown-icon">üö™</span>
                            Logout
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-container">
                {% for category, message in messages %}
                    <div class="flash-message flash-{{ category }}">
                        {{ message }}
                        <button class="close-flash">&times;</button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Profile Section -->
    <section class="profile-section">
        <div class="container">
            <div class="profile-container">
                <!-- Profile Sidebar -->
                <div class="profile-sidebar">
                    <div class="profile-avatar">
                        <div class="avatar-circle">
                            <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <circle cx="12" cy="12" r="10"></circle>
                                <circle cx="12" cy="8" r="3"></circle>
                                <path d="M6.168 18.849A4 4 0 0 1 10 16h4a4 4 0 0 1 3.834 2.855"></path>
                            </svg>
                        </div>
                        <h2>{{ user.username }}</h2>
                        <p class="profile-email">{{ user.email }}</p>
                    </div>
                    
                    <div class="profile-menu">
                        <a href="#account" class="profile-menu-item active">
                            <span class="menu-icon">üë§</span>
                            Account Details
                        </a>
                        <a href="#bookings" class="profile-menu-item">
                            <span class="menu-icon">üéüÔ∏è</span>
                            My Bookings
                        </a>
                        <a href="{{ url_for('user.settings') }}" class="profile-menu-item">
                            <span class="menu-icon">‚öôÔ∏è</span>
                            Settings
                        </a>
                    </div>
                </div>

                <!-- Profile Content -->
                <div class="profile-content">
                    <!-- Account Details -->
                    <div class="profile-card" id="account">
                        <div class="card-header">
                            <h3>Account Information</h3>
                        </div>
                        <div class="card-body">
                            <div class="info-grid">
                                <div class="info-item">
                                    <label>Username</label>
                                    <p>{{ user.username }}</p>
                                </div>
                                <div class="info-item">
                                    <label>Email Address</label>
                                    <p>{{ user.email }}</p>
                                </div>
                                <div class="info-item">
                                    <label>Member Since</label>
                                    <p>{{ user.created_at.strftime('%B %d, %Y') if user.created_at else 'N/A' }}</p>
                                </div>
                                <div class="info-item">
                                    <label>Account Status</label>
                                    <p><span class="status-badge active">Active</span></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Booking History -->
                    <div class="profile-card" id="bookings">
                        <div class="card-header">
                            <h3>Booking History</h3>
                        </div>
                        <div class="card-body">
                            {% if bookings and bookings|length > 0 %}
                                <div class="bookings-list">
                                    {% for booking in bookings %}
                                    <div class="booking-item">
                                        <div class="booking-poster">
                                            <img src="{{ booking.movie.poster_url }}" alt="{{ booking.movie.title }}">
                                        </div>
                                        <div class="booking-details">
                                            <h4>{{ booking.movie.title }}</h4>
                                            <p class="theatre-name">{{ booking.theatre_info.theatre_name }} - {{ booking.screen_name }}</p>
                                            <div class="booking-info">
                                                <span class="info-badge">üìÖ {{ booking.booking_date.strftime('%d %b %Y') }}</span>
                                                <span class="info-badge">üïê {{ booking.show_time }}</span>
                                                <span class="info-badge">üé´ {{ booking.seats|length }} Tickets</span>
                                            </div>
                                            <p class="seats-info"><strong>Seats:</strong> {{ booking.seats|join(', ') }}</p>
                                        </div>
                                        <div class="booking-actions">
                                            <div class="booking-amount">‚Çπ{{ booking.total_amount }}</div>
                                            <span class="status-badge {{ 'success' if booking.status == 'confirmed' else 'pending' }}">
                                                {{ booking.status|upper }}
                                            </span>
                                            <a href="{{ url_for('booking.booking_confirmation', booking_id=booking._id) }}" class="btn btn-sm btn-primary">View Ticket</a>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="empty-state">
                                    <div class="empty-icon">üé¨</div>
                                    <h4>No Bookings Yet</h4>
                                    <p>Start booking your favorite movies now!</p>
                                    <a href="{{ url_for('main.all_movies') }}" class="btn btn-primary">Browse Movies</a>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Book<span>Now</span></h3>
                    <p>Your ultimate destination for hassle-free movie ticket booking. Experience cinema like never before.</p>
                    <div class="social-links">
                        <a href="#" class="social-icon">üìò</a>
                        <a href="#" class="social-icon">üê¶</a>
                        <a href="#" class="social-icon">üì∑</a>
                        <a href="#" class="social-icon">‚ñ∂Ô∏è</a>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="{{ url_for('main.index') }}">Home</a></li>
                        <li><a href="{{ url_for('main.all_movies') }}">Movies</a></li>
                        <li><a href="{{ url_for('main.about') }}#why-us">Why Us</a></li>
                        <li><a href="{{ url_for('user.profile') }}">Profile</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="{{ url_for('main.about') }}#help">Help Center</a></li>
                        <li><a href="{{ url_for('main.about') }}#terms">Terms of Service</a></li>
                        <li><a href="{{ url_for('main.about') }}#privacy">Privacy Policy</a></li>
                        <li><a href="{{ url_for('main.about') }}#contact">Contact Us</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contact Info</h4>
                    <ul>
                        <li>üìß support@booknow.com</li>
                        <li>üìû +1 (555) 123-4567</li>
                        <li>üìç 123 Movie Street, Cinema City</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 BookNow. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='js/common.js') }}"></script>
    <script src="{{ url_for('static', filename='js/profile.js') }}"></script>
</body>
</html>
